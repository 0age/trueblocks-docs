---
title: "Recipe: Getting Erc20 Transfer Events"
description: "A method to extract ERC 20 Transfer events from a smart contract"
lead: "How many Transfers?"
date: 2021-04-13T08:00:02-04:00
lastmod: 2021-04-13T08:00:02-04:00
draft: false
weight: 50
images: ["getting-erc20-transfer-events.jpg"]
contributors: [Thomas Jay Rush]
---

A simple recipe to display every Transfer event from an ERC 20 contract using command line tools.

**Note:** The following assumes you have either built yourself or downloaded the TrueBlocks index of appearances. It also assumes that the address you're using is indeed an ERC 20 contract.

## Preliminaries

First, we want to query the index and make a list of every transaction that this address has ever been involved with.

```[bash]
chifra list 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

This query reports that there were 2,129 appearances (at the time of this writing) of this address anywhere on the chain. This is more appearances than you will find if you query all four of the EtherScan APIs and subsequently remove duplicates. There's a reason for this that we won't go into.

Next, we can export the transactions to the screen (just so we can see that things are working).

```[bash]
chifra export --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

The above command generates the same 2,129 records, but now with the details of the transactions.

**Note:** The `list` option gets called automatically if you simply run `export` on a new address. We are showing it here only to make this issue clear.

The `--fmt` option may be used to export data in any of three formats: `txt`, `csv` or `json`. We'll intersperse these options below.

Let's see what happens if we export the events generated during these 2,129 transactions.

## Focusing on Events / Logs

```[bash]
chifra export --fmt csv --logs 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

This takes a bit longer and generates 8,100 records. Why is that? Each transaction may (and usually does) generate more than one event. Can I speed it up? Yes. Add the `--cache_txs` option.

Before we move on, we'll add in another option called `--articulate`. The `--articulate` option turns "ugly blockchain data into human-readable text". (Try the command above both with and without `--articulate` to see the difference.)

The above command generates 8,100 log entries. This includes every event *of any type* that this address appears in. That is, any event generated by any smart contract where this address appears.

We're now going to switch to `json` output and look more deeply. The next command extracts the addresses of the contracts that emitted any of those 8,100 events:

```[bash]
chifra export --logs --articulate --fmt json 0x03fdcadc09559262f40f5ea61c720278264eb1da | grep -i address
```

This is shows every smart contract that emitted any event in which our address appears. 'Appears', in this sense, means our address appears anywhere in the event. That may mean our address emitted the event or it may mean our address was included in an event emitted by some other contract.

We want to try to limit the data to include only those events *emitted* by our smart contract.

We do this by adding the `--emitter` option.

```[bash]
chifra export --logs --articulate --emitter --fmt json 0x03fdcadc09559262f40f5ea61c720278264eb1da | grep -i address
```

And now, we see only emitter addresses of our own smart contract. If we remove the `grep` and go back to `csv`:

```[bash]
chifra export --logs --articulate --emitter --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

we now only see 3,317 events (at the time of this writing).

## The Linux Philosophy

Now we start using the Linux philosphy of piping together data producers.

First, let's just look at the first line of the data in order to see the field names:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | head -1
```

This produces:

```[csv]
"blocknumber","transactionindex","logindex","address","topic0","topic1","topic2","topic3","data","type","compressedlog"
```

We are interested in the `blockNumber`, `transactionIndex`, and `compressLog` fields, so we use the Linux command `cut` to get these columns:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | cut -d, -f1,2,11-100
```

And now we're getting somewhere.

Before we proceed, notice that we could build a histogram of the generated events thus:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | tr '"' ' ' | cut -d',' -f11-100 | cut -d'(' -f1 | sort | uniq -c
```

This produces the following data:

|-|-|
| Count | Event |
| 1 | 2 |

And finally, we get what we're after. A list of all `Transfers` events emitted by this address:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | tr '"' ' ' | cut -d',' -f1,2,11-100 | grep Transfer
```
