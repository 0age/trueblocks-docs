---
title: "Recipe: Getting Erc20 Transfer Events"
description: ""
lead: ""
date: 2021-04-13T08:00:02-04:00
lastmod: 2021-04-13T08:00:02-04:00
draft: false
weight: 50
images: ["getting-erc20-transfer-events.jpg"]
contributors: []
---

A simple recipe to display every Transfer event from an ERC 20 contract using command line tools.

**Note:** The following assumes you have either built yourself or downloaded the TrueBlocks index of appearances. It also assumes that the address you're using is indeed an ERC 20 contract.

First, we want to query the index and make a list of every transaction that this address has ever been involved with.

```[bash]
chifra list 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

This query reports that there were 2,129 appearances (at the time of this writing) of this address anywhere on the chain. This is more appearances than you will find if you query all four of the EtherScan APIs and subsequently remove duplicates. There's a reason for this that we won't go into.

Next, we can export the transactions to the screen (just so we can see that things are working).

```[bash]
chifra export --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

The above command generates the same 2,129 records, but now with the details of the transactions.

**Note:** The `list` option gets called automatically if you simply run `export` on a new address. We are showing it here only to make this issue clear.

The `--fmt` option may be used to export data in any of three formats: `txt`, `csv` or `json`. We'll intersperse these options below.

Let's see what happens if we export the events generated during these 2,129 transactions.

```[bash]
chifra export --fmt csv --logs 0x03fdcadc09559262f40f5ea61c720278264eb1da
```

This takes a bit longer and generates 8,100 records. Why is that? Each transaction may (and usually does) generate more than one event.

Before we move on, we'll add another option called `--articulate`. The `--articulate` option turns "ugly blockchain data into human-readable text". (Try the command above both with and without `--articulate` to see the difference.)

The above command generates 8,100 log entries. This includes every event *of any type* that this address appears in. That is, any event generated by any smart contract where the address appears.

We're now going to switch to `json` output and extract the addresses of the contracts emitting those 8,100 events:

```[bash]
chifra export --logs --articulate --fmt json 0x03fdcadc09559262f40f5ea61c720278264eb1da | grep -i address
```

This is every contract address that emitted any event in which our address appears. 'Appears' in this case might be because this address emitted the event or because some other contract emitted an event in which this address was involved.

Next, we want to limit the data to only those events that were *emitted* by our address.

We do this by adding the `--emitter` option.

```[bash]
chifra export --logs --articulate --emitter --fmt json 0x03fdcadc09559262f40f5ea61c720278264eb1da | grep -i address
```

And now, we see only those events generated by this address (3,317 at the time of this writing). Let's switch back to `csv` and see what that looks like. Now we start using the Linux philosphy of piping together data producers. Here, we show just the first line, so we can see the field names

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | head -1
```

We get

```[csv]
"blocknumber","transactionindex","logindex","address","topic0","topic1","topic2","topic3","data","type","compressedlog"```

We are interested in the `blockNumber`, `transactionIndex`, and `compressLog` fields, so we do this:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | cut -d, -f1,2,11-100
```

And now you can see we're getting somewhere.

Before we proceed, notice that we could build a histogram of the routines thus:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | tr '"' ' ' | cut -d',' -f11-100 | cut -d'(' -f1 | sort | uniq -c
```

And finally, we get what we're after. A list of all Transfers on emitted by this address:

```[bash]
chifra export --logs --articulate --fmt csv 0x03fdcadc09559262f40f5ea61c720278264eb1da | tr '"' ' ' | cut -d',' -f1,2,11-100 | grep Transfer
```
